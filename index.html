<button onclick="resetCanvas()">Reset</button>
<canvas id="dx_canvas"></canvas>
<span id="valeur1">Valeur bande 1 = 0</span>
<span id="valeur2">Valeur bande 2 = 0</span>
<span id="valeur3">Code DX = 000000</span>
<script>
var canvas = document.getElementById('dx_canvas');
var ctx = canvas.getContext("2d");
var longueur = 10
var hauteur = 40
var xSize = 18
var ySize = 2
var valeur_bandes = [0,0,0,0,0,0,64,32,16,8,4,2,1,0,8,4,2,1]

var canvasCreate = function(w, h) {
  canvas.width = w;
  canvas.height = h;
};

function resetCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  arr = genArray();
  drawGrid(arr);
}

function genArray() {
  var a = [];
  for (i=0;i<xSize;i++) {
    a[i] = [];
    for (j=0;j<ySize;j++) {
      a[i][j] = 0;
    }
  }
  return a;
}

function drawGrid(arr) {
  
  for (var i=0;i<xSize;i++) {
    for (var j=0;j<ySize;j++) {
      ctx.beginPath();
      ctx.strokeStyle = '#555';
      if (arr[i][j] === 1) {
        ctx.fillStyle = '#000';
        ctx.fillRect(i*longueur, j*hauteur, longueur, hauteur);
      } else {
        ctx.fillStyle = '#fff';
        ctx.fillRect(i*longueur, j*hauteur, longueur, hauteur);
      }
      ctx.rect(i*longueur, j*hauteur, longueur, hauteur);
      ctx.stroke();
    }
  }
};

var arr = genArray();
canvasCreate(xSize*longueur, ySize*hauteur);
drawGrid(arr);

function mouseClick(e) {

  // Calcul de la position de la souris dans le canvas
  var mouseX, mouseY;

  if(e.offsetX) {
    mouseX = e.offsetX;
    mouseY = e.offsetY;
  }
  else if(e.layerX) {
    mouseX = e.layerX;
    mouseY = e.layerY;
  }
  
  // Trouver la case cliquée
  var gridX = Math.floor(mouseX / longueur);
  var gridY = Math.floor(mouseY / hauteur);

  // Remplir la case
  var xy = arr[gridX][gridY];
  if (xy == 0) {
    arr[gridX][gridY] = 1;
  }
  else if (xy == 1) {
    arr[gridX][gridY] = 0;
  }

  drawGrid(arr);
  
  //calculer valeur des bandes & code DX
  var valeur_part1 = 0
  var valeur_part2 = 0
  
   for (var i=6;i<13;i++) {
	valeur_part1 = valeur_part1 + arr[i][1] * valeur_bandes[i]
   }
  
   for (var i=14;i<18;i++) {
	valeur_part2 = valeur_part2 + arr[i][1] * valeur_bandes[i]
   }
   
  var code_dx = String(16 * valeur_part1 + valeur_part2).padStart(6, '0')
  
  //mise à jour de l'affichage
  document.getElementById("valeur1").textContent="Valeur partie 1 = " + valeur_part1;
  document.getElementById("valeur2").textContent="Valeur partie 2 = " + valeur_part2;
  document.getElementById("valeur3").textContent="Code DX = " + code_dx;
  
}

canvas.addEventListener('mousedown', mouseClick, false);
</script>
